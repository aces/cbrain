
!--
#
# CBRAIN Project
#
# Copyright (C) 2008-2012
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-->

<h1>Diagnostics</h1>

This task is provided with the basic CBRAIN platform. It serves several
purposes:

<ul>
  <li>It can be used to verify the configuration of a Bourreau server, including
      testing the full cycle of setting up a job, launching it, and post processing it;</li>
  <li>It can be used by system programmers to try (and validate) the special
      form input fields helpers that CBRAIN provides for writing CbrainTasks;</li>
  <li>It can ask the Bourreau side to perform some connectivity tests with the Data Providers;</li>
  <li>It can be used by system programmers to trigger some task lifecycle events on the Portal side
      during task creation and edit, in order to test the Rails tasks_controller.</li>
</ul>

<h3>Parameters</h3>

<h4>Input Files:</h4>
<p>

This is an arbitrary list of one or more files that
were selected by the user; this task will simply synchronize them, and either
run the UNIX <em>du</em> command when the files are directories, or <em>wc</em>
if they are simple files. This will test that the Bourreau server is actually
capable of running a bash script as a job on the local cluster.



<p>
<h4>Do not actually submit job script on cluster:</h4>
<p>

When set, no job will be submitted on the cluster; the rest of the task's life cycle
will be performed normally, however (<em>Setup</em> and <em>Post Processing</em> for instance).



<p>
<h4>Life Cycle Table</h4>
<p>

Here you can selectively trigger several events in the life cycle
of this task while being processed on the Bourreau side. These
events are mostly useful for system programmers who want to test
the CBRAIN framework's ability to handle them. There are three main
stages represented in this table:

<p>

<ul>
  <li><strong>Setup</strong>: when Ruby code for the task's setup() method is invoked;</li>
  <li><strong>Cluster</strong>: when the bash script is executed on the cluster;</li>
  <li><strong>PostProcess</strong>: when Ruby code for the task's post_process() method is invoked.</li>
</ul>

<p>

In each case, it is possible to force the task to wait for a certain
number of seconds, and then to <em>crash</em>. In the case of Ruby
code, crashing will mean explicitely raising a Ruby exception. In
the case of on <strong>Cluster</strong>, it means the post_process()
method will pretend that the bash script has not performed succesfully
and will return 'false'.

<p>

For each of these stages, it is possible to enable the six callback
methods for the restart capabilities API or error recovery API, and
to make them wait a certain number of seconds too.



<p>
<h4>Crashes will reset to false after they are first triggered</h4>
<p>

It's possible to make the synthetic crashes configured in the previous table
happen only once. This can test a scenario where an error occurs, then
recovery is attempted and then everything returns to normal.




<p>
<h4>Check Data Providers Access</h4>
<p>

Each Data Provider selected in this table will be polled during
the task's <strong>Setup</strong> stage. A report of their availability
will be put inside the task's log.



<p>
<h4>Input Fields Validation Tests</h4>
<p>

These are used to test the validation code associated with input
fields of different type. These input fields are generated by
the CBRAIN framework's CbrainTaskFormBuilder helper methods,
and the Diagnostics task has, built-in, a set of dummy rule
for validating them. Entering incorrect values will make sure
they are highlighted properly. This is mostly used to verify
the framework itself, not the Diagnostic task.



<p>
<h4>Interface after_form() Lifecycle Test</h4>
<p>

This section controls the behavior of the diagnostics task's
after_form() method. It can be made to raise exception, or
return a particular message string, and/or store that string
as a field error associated with the text input box.



<p>
<h4>Erase report after it is created</h4>
<p>

The diagnostics tasks usually create a new file within CBRAIN
containing the text of its bash job's output. If it's not really
needed to be kept, it can be made to be automatically deleted
after creation (this will still test that the diagnostics task
is able to create files on the Data Provider chosen for its output,
but will not clutter it with the report itself).



<p>
<h4>Stress-Testing</h4>
<p>

<strong>Warning: can be costly</strong> This options allow the
operator to launch a great quantity of the identical copies of
the diagnostics task.



<h3>See also</h3>

This task is maintained by the CBRAIN development team. See
the <A HREF="https://github.com/aces/cbrain/wiki">Wiki</A>
for the platform for more information about the CbrainTask life
cycles and other programming concepts.

<p>

