
<!--
#
# CBRAIN Project
#
# Copyright (C) 2008-2021
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-->

<%-
  # Parameter groups
  @descriptor ||= @task.descriptor_for_form
  file_inputs   = @descriptor.inputs.select { |i| i['type'] == 'File' }
  other_inputs  = @descriptor.inputs.select { |i| i['type'] != 'File' }
  outputs       = @descriptor.output_files.dup
-%>

<%# Format a parameter (+param+) attributes as a list element (<li>) -%>
<%- format_param = lambda do |param| -%>
  <li>
    <strong>
      <%= param.name %>
  <%- if param.command_line_flag -%>
      (<code class="cmd-flag"><%= param.command_line_flag %></code>)
  <%- end -%>
  <%- if param.description.present? -%>
    </strong>:
    <% param.description.split("\n").each do |line| %>
      <%= line %><br>
    <% end %>
  <%- else -%>
    </strong>
  <%- end -%>
  </li>
<%- end -%>

<h1><%= @descriptor.name %> <%= @descriptor.tool_version %></h1>

<% if @descriptor.description.presence %>
  <h2>Description</h2>
  <% (@descriptor.description.presence || "").split("\n").each do |line| %>
    <%= line %><br>
  <% end %>
  <p>
<% end %>

<% if @descriptor.tool_doi.present? %>
  <strong>Tool DOI:</strong> <%= link_to @descriptor.tool_doi, @descriptor.tool_doi, :target => '_blank', :class => 'action_link' %>
  <br>
<% end %>

<% if @descriptor.url.present? %>
  <strong>Tool URL:</strong> <%= link_to @descriptor.url, @descriptor.url, :target => '_blank', :class => 'action_link' %>
  <br>
<% end %>

<% if @descriptor.descriptor_url.present? %>
  <strong>Boutiques Descriptor::</strong> <%= link_to @descriptor.descriptor_url, @descriptor.descriptor_url, :target => '_blank', :class => 'action_link' %>
  <br>
<% end %>

<%- unless other_inputs.empty? -%>
<h2>Parameters</h2>
<ul>
  <%- other_inputs.each { |input| format_param.(input) } -%>
</ul>
<%- end -%>

<%- unless file_inputs.empty? -%>
<h2>Input files</h2>
<ul>
  <%- file_inputs.each { |input| format_param.(input) } -%>
</ul>

<%- end -%>
<%- unless outputs.empty? -%>
<h2>Output files</h2>
<ul>
  <%- outputs.each { |output| format_param.(output) } -%>
</ul>
<%- end -%>

<%- unless file_inputs.empty? -%>
<h2>Launching Multiple Tasks</h2>
<%- single_file = (file_inputs.length == 1) && (! file_inputs.first.optional) -%>
<p>
  Multiple instances of this tool can <%= "also" if single_file %> be launched simultaneously using the <em>CBRAIN File List</em> mechanism ("cbcsv" files).
  Essentially, a cbcsv file is a csv file with a list of a user's files registered in CBRAIN.
  <%- if single_file -%>
  Note that if one or more cbcsv files are automatically input to a file parameter (i.e. when there is only a single file input),
    each cbcsv will be expanded to its constituent files (i.e. a task will be generated for each row).
  <%- end -%>
</p>
<p>
  A cbcsv file can be created in CBRAIN by selecting a set of input files from which one wishes to launch a set of tasks,
    clicking on the "More" button under the "Files" tab, and clicking "Create a file list".
  A cbcsv file will be created and added to your CBRAIN fileset, wherein each row represents a file and the first column represents its ID in CBRAIN.
  Selecting a cbcsv file for a file-type input parameter to the task will result in one copy of the task being launched for each file in the cbcsv,
    with each task being given a different input file (from each row) for the parameter with the cbcsv (i.e. in its place).
  If multiple cbcsv files in different file inputs are given, they must be the same length, as tasks will be generated by iterating over the rows of <em>all</em> the input cbcsv files simultaneously.
    Should one wish to launch all combinations of input file parameters among several lists, the cbcsv files must be constructed explicitly for this.
  It is also possible to download, manipulate, and re-upload a cbcsv file (e.g. if one has local ordered lists of files for a specific task already).
</p>
<p>
  Note that rows with IDs of 0 (zero) in the first column are treated as "null" inputs, and no value will be given to the task for that row under that parameter
    (this is useful if one wishes to have no input given to a certain parameter for some of the launched tasks).
</p>
<%- end -%>

