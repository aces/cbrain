Array.prototype.min=function(){var b=50000;if(this.length>b){var a=[];for(var c=0;c<this.length;c+=b){a.push(Math.min.apply(Math,this.slice(c,c+b-1)))}}else{return Math.min.apply(Math,this)}return a.min()};Array.prototype.max=function(d){var b=50000;if(this.length>b){var a=[];for(var c=0;c<this.length;c+=b){a.push(Math.max.apply(Math,this.slice(c,c+b-1)))}}else{return Math.max.apply(Math,this)}return a.max()};function cloneArray(b){var c=new Array(b.length);for(var a=0;a<c.length;a++){c[a]=b[a]}return c}function rotateUint16Array90Left(f,d,a){var e=new Uint16Array(d*a);for(var c=0;c<d;c++){for(var b=0;b<a;b++){e[c*a+b]=f[b*d+(d-c)]}}return e}function rotateUint16Array90Right(f,d,a){var e=new Uint16Array(d*a);for(var c=0;c<d;c++){for(var b=0;b<a;b++){e[c*a+b]=f[(a-b)*d+c]}}return e}function interpolateDataArray(g,c,b,a){console.log(g.values.length);var e=g.values.length;var f=new Array(e);console.log("Percentage: "+b);for(var d=0;d<e;d++){if(a){f[d]=(g.values[d]*(100-b*100)+c.values[d]*(b*100))/100}else{f[d]=(g.values[d]*(100-b*100)+c.values[d]*(b*100))/100}}console.log(f.length);return f}var mindframe={};mindframe.colorManager=function(){var a=[];function d(m,e,q,j,o,l,n,h,g){var m=m.colors;var p=((o-j)+(o-j)/m.length)/m.length;for(var k=0;k<q.length;k++){if(q[k]<=j){var r=0}else{if(q[k]>o){var r=m.length-1}else{var r=parseInt((q[k]-j)/p)}}if(l){var f=255}else{var f=1}e[k*4+0]=f*m[r][0]*h+n*f;e[k*4+1]=f*m[r][1]*h+n*f;e[k*4+2]=f*m[r][2]*h+n*f;if(g){e[k*4+3]=f*g}else{e[k*4+3]=f}}return e}a.createColorMap=d;function b(l){var e=l[0];for(var h=0;h<l[0].length/4;h++){for(var g=1;g<l.length;g++){var f=e[h*4+3];var k=l[g][h*4+3];e[h*4]=e[h*4]*f+l[g][h*4]*k;e[h*4+1]=e[h*4+1]*f+l[g][h*4+1]*k;e[h*4+2]=e[h*4+2]*f+l[g][h*4+2]*k;e[h*4+3]=f+k}}return e}a.blendColors=b;function c(f,m,k,h){var e=m.length;var l=new Array(e);var j=0;for(var g=0;g<e;g++){l[g]=d(f,new Array(m[g].values.length),m[g].values,m[g].rangeMin,m[g].rangeMax,false,0,1,m[g].alpha)}return b(l)}a.blendColorMap=c;return a}();function MNIObject(c){var h;var f=this;this.parse=function(l){f.num_hemispheres=1;var k=l.replace(/\s+$/,"");var m=k.replace(/^\s+/,"");h=m.split(/\s+/).reverse();f.objectClass=h.pop();if(f.objectClass=="P"){d();f.numberVertices=parseInt(h.pop());e();j();f.nitems=parseInt(h.pop())}else{if(f.objectClass=="L"){d();f.numberVertices=parseInt(h.pop());e();f.nitems=parseInt(h.pop())}else{throw new Error("That object class is not supported currently")}}g();b();a();if(f.objectClass=="P"){if(f.positionArray.length==81924*3){f.brainSurface=true;f.split_hemispheres()}}};function d(){if(f.objectClass=="P"){f.surfaceProperties={ambient:parseFloat(h.pop()),diffuse:parseFloat(h.pop()),specular_reflectance:parseFloat(h.pop()),specular_scattering:parseFloat(h.pop()),transparency:parseFloat(h.pop())}}else{if(f.objectClass=="L"){f.surfaceProperties={width:h.pop()}}}}function e(){f.positionArray=new Array();for(var k=0;k<f.numberVertices;k++){for(var l=0;l<3;l++){f.positionArray.push(parseFloat(h.pop()))}}}function j(){f.normalArray=new Array();for(var l=0;l<f.numberVertices;l++){for(var k=0;k<3;k++){f.normalArray.push(parseFloat(h.pop()))}}}function g(){f.colorFlag=parseInt(h.pop());f.colorArray=new Array();if(f.colorFlag===0){for(var k=0;k<4;k++){f.colorArray.push(parseFloat(h.pop()))}}else{if(f.colorFlag===1){for(var l=0;l<f.numberPolygons;l++){for(var k=0;k<4;k++){f.colorArray.push(parseFloat(h.pop()))}}}else{if(f.colorFlag===2){for(var l=0;l<f.numberVertices;l++){for(var k=0;k<4;k++){f.colorArray.push(parseFloat(h.pop()))}}}else{throw new Error("colorFlag not valid in that file")}}}}function b(){f.endIndicesArray=new Array();for(var k=0;k<f.nitems;k++){f.endIndicesArray.push(parseInt(h.pop()))}}function a(){f.indexArray=new Array();var l=h.length;for(var k=0;k<l;k++){f.indexArray.push(parseInt(h.pop()))}}this.split_hemispheres=function(){this.left={};this.right={};var o=this.positionArray.length;this.left.positionArray=this.positionArray.slice(0,o/2);this.right.positionArray=this.positionArray.slice(o/2,o);var n=this.indexArray.length;this.left.indexArray=this.indexArray.slice(0,n/2);this.right.indexArray=this.indexArray.slice(n/2,n);for(var k=0;k<this.right.indexArray.length;k++){this.right.indexArray[k]=this.right.indexArray[k]-2-n/3/2/2}var l=this.normalArray.length;this.left.normalArray=this.normalArray.slice(0,l/2);this.right.normalArray=this.normalArray.slice(l/2,l);this.left.colorFlag=this.colorFlag;this.right.colorFlag=this.colorFlag;if(this.colorFlag==0||this.colorFlag==1){this.left.colorArray=this.colorArray;this.right.colorArray=this.colorArray}else{var m=this.colorArray.length;this.left.colorArray=this.colorArray.slice(0,m/2);this.right.colorArray=this.colorArray.slice(m/2+1,-1)}this.left.numberVertices=this.numberVertices/2;this.right.numberVertices=this.numberVertices/2;this.left.numberPolygons=this.numberPolygons/2;this.right.numberPolygons=this.numberPolygons/2;this.num_hemispheres=2};this.getVertexInfo=function(l){var k=[this.positionArray[l*3],this.positionArray[l*3+1],this.positionArray[l*3+2]];return{vertex:l,position_vector:k}};this.get_vertex=function(v,s,l){if(this.num_hemispheres>1){var r=this[l];var o=0;if(l=="right"){o=2+r.indexArray.length/3/2}}else{var r=this;var o=0}var q=new Array();var y=v*3;for(var p=0;p<3;p++){q.push(r.indexArray[y+p])}var w=new Array();for(var p=0;p<3;p++){var u=q[p]*3;w[p]=new Array();for(var n=0;n<3;n++){w[p][n]=r.positionArray[u+n]}}var x=new Array();for(var p=0;p<3;p++){x.push(o3djs.math.distance(s,w[p]))}var m=0;if(x[1]<x[0]){m=1}if(x[2]<x[m]){m=2}var t=q[m]+o;var z=w[m];return{vertex:t,position_vector:z}};if(c){this.parse(c)}}function bbObject(a){var b=a;b.createBrain=function(d,c){b.model_data=d;if(d.num_hemispheres==2){var e={left:b.createHemisphere(d.left,"left"),right:b.createHemisphere(d.right,"right"),num_hemisphere:2}}else{var e=b.createHemisphere(d,"filename");e.num_hemisphere=1}if(b.brainTransform==null){b.brainTransform=b.pack.createObject("Transform");if(d.num_hemispheres==2){b.brainHemisphereTransforms={};b.brainHemisphereTransforms.left=b.pack.createObject("Transform");b.brainHemisphereTransforms.right=b.pack.createObject("Transform")}}else{b.brainTransform.removeShape(b.brainTransform.shapes[0]);if(b.brainTransform.children[0]!=null){b.brainTransform.children[0].removeShape(b.brainTransform.children[0].shapes[0])}if(b.brainTransform.children[1]!=null){b.brainTransform.children[1].removeShape(b.brainTransform.children[1].shapes[0])}}if(d.num_hemispheres!=2){b.brainTransform.removeParam(b.brainTransform.children[0]);b.brainTransform.removeParam(b.brainTransform.children[1])}if(d.num_hemispheres==2&&b.brainHemisphereTransforms==null){b.brainHemisphereTransforms={};b.brainHemisphereTransforms.left=b.pack.createObject("Transform");b.brainHemisphereTransforms.right=b.pack.createObject("Transform")}b.brainTransform.parent=b.client.root;if(e.num_hemisphere==1){b.brainTransform.addShape(e);e.createDrawElements(b.pack,null)}else{b.brainHemisphereTransforms.left.parent=b.brainTransform;b.brainHemisphereTransforms.right.parent=b.brainTransform;b.brainHemisphereTransforms.left.addShape(e.left);b.brainHemisphereTransforms.right.addShape(e.right);e.left.createDrawElements(b.pack,null);e.right.createDrawElements(b.pack,null)}b.model_data=d;if(b.afterCreateBrain!=undefined){b.afterCreateBrain(b.model_data)}};b.createLineObject=function(f,e){b.model_data=f;var c=b.createMaterial("/shaders/line.txt");var g=c.getParam("transAlpha");g.value=1;var d=b.createLineShape(c,f);d.name=e;if(b.brainTransform==undefined){b.brainTransform=b.pack.createObject("Transform")}b.brainTransform.parent=b.client.root;b.brainTransform.addShape(d);d.createDrawElements(b.pack,null);b.model_data=f;if(b.afterCreate!=undefined){b.afterCreate(b.model_data)}};b.createPolygonObject=function(f,e){b.model_data=f;var c=b.createMaterial("/shaders/blinnphong.txt");c=b.blinnphongParams(c);var d=b.createPolygonShape(c,f);d.name=e;if(b.brainTransform==undefined){b.brainTransform=b.pack.createObject("Transform")}b.brainTransform.parent=b.client.root;b.brainTransform.addShape(d);d.createDrawElements(b.pack,null);b.model_data=f;if(b.afterCreate!=undefined){b.afterCreate(b.model_data)}};b.createHemisphere=function(h,e){var j=b.createMaterial("/shaders/blinnphong.txt");j=b.blinnphongParams(j);var r=b.pack.createObject("Shape");var o=b.pack.createObject("Primitive");var t=b.pack.createObject("StreamBank");o.material=j;o.owner=r;o.streamBank=t;r.name=e;o.primitiveType=b.o3d.Primitive.TRIANGLELIST;var d=b.pack.createObject("State");b.enableAlphaBlending(d);o.material.state=d;var l=b.pack.createObject("VertexBuffer");var n=l.createField("FloatField",3);if(!h.positionArray){alert("PositionArray nil");return false}l.set(h.positionArray);b.numberVertices=h.numberVertices;var s=(h.positionArray.length/3);o.numberVertices=b.numberVertices;if(!h.indexArray){alert("Index Array nil");return false}o.numberPrimitives=h.indexArray.length/3;var g=b.pack.createObject("IndexBuffer");g.set(h.indexArray);o.indexBuffer=g;var q=b.pack.createObject("VertexBuffer");var k=q.createField("FloatField",3);q.set(h.normalArray);var m=[];if(h.colorArray.length==4){for(var f=0;f<s;f++){m.push.apply(m,h.colorArray)}}else{m=h.colorArray}if(m.length<h.positionArray.length){alert("Problem with the colors: "+m.length)}var p=b.pack.createObject("VertexBuffer");var c=p.createField("FloatField",4);p.set(m);m=[];if(b.loading){jQuery(b.loading).html("Buffers Loaded")}t.setVertexStream(b.o3d.Stream.POSITION,0,n,0);t.setVertexStream(b.o3d.Stream.NORMAL,0,k,0);t.setVertexStream(b.o3d.Stream.COLOR,0,c,0);return r};b.createLineShape=function(n,f,x){var m=b.pack.createObject("Shape");var w=b.pack.createObject("StreamBank");m.name=x;if(!f.positionArray){alert("PositionArray nil");return false}b.numberVertices=f.numberVertices;var t=b.pack.createObject("Primitive");t.material=n;t.owner=m;t.streamBank=w;t.primitiveType=b.o3d.Primitive.LINELIST;var h=b.pack.createObject("State");b.enableAlphaBlending(h);t.material.state=h;var d=new Array();for(var s=0;s<f.nitems;s++){if(s==0){var g=0}else{var g=f.endIndicesArray[s-1]}d.push(f.indexArray[g]);for(var q=g+1;q<f.endIndicesArray[s]-1;q++){d.push(f.indexArray[q]);d.push(f.indexArray[q])}d.push(f.indexArray[f.endIndicesArray[s]-1])}var e=b.pack.createObject("IndexBuffer");t.numberPrimitives=d.length/2;t.numberVertices=d.length;b.indexArray=d;var c=new Float32Array(d.length*3);for(var r=0;r<d.length;r++){c[r*3]=f.positionArray[d[r]*3];c[r*3+1]=f.positionArray[d[r]*3+1];c[r*3+2]=f.positionArray[d[r]*3+2]}var l=[];if(f.colorArray.length==4){for(var s=0;s<numberVertices;s++){l.push.apply(l,[0.5,0.5,0.7,1])}}else{l=new Float32Array(d.length*4);for(var r=0;r<d.length;r++){l[r*4]=f.colorArray[d[r]*4];l[r*4+1]=f.colorArray[d[r]*4+1];l[r*4+2]=f.colorArray[d[r]*4+2];l[r*4+3]=f.colorArray[d[r]*4+3]}}var u=b.pack.createObject("VertexBuffer");var o=u.createField("FloatField",3);u.set(c);w.setVertexStream(b.o3d.Stream.POSITION,0,o,0);if(l.length<f.positionArray.length){alert("Problem with the colors: "+l.length)}var p=b.pack.createObject("VertexBuffer");var v=p.createField("FloatField",4);p.set(l);l=[];w.setVertexStream(b.o3d.Stream.COLOR,0,v,0);if(b.loading){jQuery(b.loading).html("Buffers Loaded")}b.pack.gl.lineWidth(1);return m};b.createPolygonShape=function(l,f,w){var t=b.pack.createObject("Shape");var v=b.pack.createObject("StreamBank");t.name=w;if(!f.positionArray){alert("PositionArray nil");return false}b.numberVertices=f.numberVertices;var d=b.pack.createObject("Primitive");d.material=l;d.owner=t;d.streamBank=v;d.primitiveType=b.o3d.Primitive.TRIANGLELIST;var g=b.pack.createObject("State");b.enableAlphaBlending(g);d.material.state=g;var e=f.indexArray;d.numberPrimitives=e.length/3;d.numberVertices=e.length;b.indexArray=e;var c=new Float32Array(e.length*3);var r=new Float32Array(e.length*3);for(var p=0;p<e.length;p++){c[p*3]=f.positionArray[e[p]*3];c[p*3+1]=f.positionArray[e[p]*3+1];c[p*3+2]=f.positionArray[e[p]*3+2];r[p*3]=f.normalArray[e[p]*3];r[p*3+1]=f.normalArray[e[p]*3+1];r[p*3+2]=f.normalArray[e[p]*3+2]}var h=[];if(f.colorArray.length==4){for(var q=0;q<d.numberVertices;q++){h.push.apply(h,f.colorArray)}}else{h=new Float32Array(e.length*4);for(var p=0;p<e.length;p++){h[p*4]=f.colorArray[e[p]*4];h[p*4+1]=f.colorArray[e[p]*4+1];h[p*4+2]=f.colorArray[e[p]*4+2];h[p*4+3]=f.colorArray[e[p]*4+3]}}var k=b.pack.createObject("VertexBuffer");var n=k.createField("FloatField",3);k.set(r);v.setVertexStream(b.o3d.Stream.NORMAL,0,n,0);var s=b.pack.createObject("VertexBuffer");var m=s.createField("FloatField",3);s.set(c);v.setVertexStream(b.o3d.Stream.POSITION,0,m,0);if(h.length<f.positionArray.length){alert("Problem with the colors: "+h.length)}var o=b.pack.createObject("VertexBuffer");var u=o.createField("FloatField",4);o.set(h);h=[];v.setVertexStream(b.o3d.Stream.COLOR,0,u,0);if(b.loading){jQuery(b.loading).html("Buffers Loaded")}return t}}function Spectrum(e){var c=this;var a=mindframe.colorManager;function b(f,p,h,o){var j=document.createElement("canvas");jQuery(j).attr("width",256);jQuery(j).attr("height",h);var l=new Array(256);for(var n=0;n<256;n++){if(o){l[255-n]=n}else{l[n]=n}}f=a.createColorMap(c,[],l,0,255,true,0,1);var g=j.getContext("2d");for(var m=0;m<256;m++){g.fillStyle="rgb("+parseInt(f[m*4])+","+parseInt(f[m*4+1])+","+parseInt(f[m*4+2])+")";g.fillRect(m,0,1,p)}console.log("rgb("+parseInt(f[100*4+0])+","+parseInt(f[100*4+1])+","+parseInt(f[100*4+2]));console.log(g.fillStyle);return j}c.createSpectrumCanvas=function(f){if(f==null){f=c.colors}var g=b(f,20,20,false);return g};c.createSpectrumCanvasWithScale=function(k,f,g,l){if(g==null){g=c.colors}var h=b(g,20,40,l);var j=h.getContext("2d");j.fillStyle="#FFA000";j.fillRect(0.5,20,1,10);j.fillText(k.toPrecision(3),0.5,40);j.fillRect(h.width/4,20,1,10);j.fillText(((k+f)/4).toPrecision(3),h.width/4,40);j.fillRect(h.width/2,20,1,10);j.fillText(((k+f)/2).toPrecision(3),h.width/2,40);j.fillRect(3*(h.width/4),20,1,10);j.fillText((3*((k+f)/4)).toPrecision(3),3*(h.width/4),40);j.fillRect(h.width-0.5,20,1,10);j.fillText(f.toPrecision(3),h.width-20,40);return h};function d(m){m=m.replace(/\s+$/,"");m=m.replace(/^\s+/,"");var j=m.split(/\n/);var f=new Array();for(var h=0;h<j.length;h++){var l=j[h].replace(/\s+$/,"").split(/\s+/);for(var g=0;g<l.length;g++){l[g]=parseFloat(l[g])}if(l.length<4){l.push(1)}f.push(l)}c.colors=f;return f}if(e!=undefined){d(e)}}function Data(b){var a=this;a.parse=function(c){c=c.replace(/\s+$/,"");c=c.replace(/^\s+/,"");a.values=c.split(/\s+/);for(var d=0;d<a.values.length;d++){a.values[d]=parseFloat(a.values[d])}a.min=a.values.min();a.max=a.values.max()};this.createColorArray=function(d,h,g,f,l,c){var g=g.colors;var k=new Array();var j=((h-d)+(h-d)/g.length)/g.length;for(var e=0;e<a.values.length;e++){if(a.values[e]<=d){if(a.values[e]<d&&!l){var m=-1}else{var m=0}}else{if(a.values[e]>h){if(!l){var m=-1}else{var m=g.length-1}}else{var m=parseInt((a.values[e]-d)/j)}}if(f&&m!=-1){k.push.apply(k,g[g.length-1-m])}else{if(m==-1){if(c.length==4){k.push.apply(k,c)}else{k.push.apply(k,[c[e*4],c[e*4+1],c[e*4+2],c[e*4+3]])}}else{k.push.apply(k,g[m])}}}return k};if(b){if(typeof b=="string"){a.parse(b)}else{if(b.values!=undefined){this.values=cloneArray(b.values);this.min=this.values.min();this.max=this.values.max()}else{console.log("copying data length: "+b.length);this.values=b;this.min=b.min();this.max=b.max()}}}}o3djs.base.o3d=o3d;o3djs.require("o3djs.webgl");o3djs.require("o3djs.math");o3djs.require("o3djs.rendergraph");o3djs.require("o3djs.pack");o3djs.require("o3djs.picking");o3djs.require("o3djs.arcball");o3djs.require("o3djs.quaternions");o3djs.require("o3djs.scene");function BrainBrowser(){var g=this;bbObject(this);var e=mindframe.colorManager;this.init=function(){o3djs.webgl.makeClients(g.initStep2)};this.initStep2=function(m){var n=m[0];g.o3dElement=n;g.client=n.client;g.o3d=n.o3d;g.math=o3djs.math;g.dragging=false;g.o3dWidth=-1;g.o3dHeight=-1;g.quaternions=o3djs.quaternions;g.lastRot=g.math.matrix4.identity();g.thatRot=g.math.matrix4.identity();g.zoomFactor=1.1;g.keyPressDelta=0.1;g.clock=0;g.timeMult=1;g.camera={farPlane:5000,nearPlane:0.1};g.object_origin=[0,0,0];g.loading=jQuery("#o3d_loading");o3djs.base.init(n);g.pack=g.client.createPack();var l=o3djs.rendergraph.createBasicView(g.pack,g.client.root,g.client.renderGraphRoot,[0.5,0.5,0.5,1]);g.viewInfo=l;l.drawContext.projection=g.math.matrix4.perspective(g.math.degToRad(30),g.client.width/g.client.height,1,5000);g.eyeView=[0,0,500];l.drawContext.view=g.math.matrix4.lookAt(g.eyeView,[0,0,0],[0,1,0]);g.aball=o3djs.arcball.create(100,100);g.client.setRenderCallback(g.renderCallback);jQuery("body").keydown(g.keyPressedCallback);o3djs.event.addEventListener(n,"wheel",g.scrollMe);g.loadSpectrumFromUrl("/assets/spectral_spectrum.txt");if(g.afterInit){g.afterInit(g)}g.updateInfo();jQuery("#screenshot").click(function(o){jQuery(this).attr("href",bb.client.toDataURL())})};this.uninit=function(){if(this.client){this.client.cleanup()}};this.renderCallback=function(l){g.setClientSize();if(g.autoRotate==true){g.clock=0;g.clock+=l.elapsedTime*g.timeMult;g.brainTransform.rotateY(0.1*g.clock);g.brainTransform.rotateZ(0.1*g.clock)}};this.createMaterial=function(l){var n=g.pack.createObject("Effect");var o=g.loadCombinedShaderFromUrl(l);n.loadFromFXString(o);var m=g.pack.createObject("Material");m.drawList=g.viewInfo.performanceDrawList;m.effect=n;n.createUniformParameters(m);return m};function d(l){l.getStateParam("AlphaBlendEnable").value=true;l.getStateParam("SourceBlendFunction").value=o3djs.base.o3d.State.BLENDFUNC_SOURCE_ALPHA;l.getStateParam("DestinationBlendFunction").value=o3djs.base.o3d.State.BLENDFUNC_INVERSE_SOURCE_ALPHA;l.getStateParam("AlphaTestEnable").value=true;l.getStateParam("AlphaComparisonFunction").value=o3djs.base.o3d.State.CMP_GREATER}g.enableAlphaBlending=d;this.clearScreen=function(){if(brainbrowser.brainTransform!=undefined){if(brainbrowser.brainTransform.shapes!=undefined){var l=brainbrowser.brainTransform.shapes.length;for(var m=0;m<l;m++){brainbrowser.brainTransform.removeShape(brainbrowser.brainTransform.shapes[0])}}if(brainbrowser.brainTransform.children.length){var n=brainbrowser.brainTransform.children.length;for(var m=0;m<n;m++){var l=brainbrowser.brainTransform.children[m].length;brainbrowser.brainTransform.children[m].removeShape(brainbrowser.brainTransform.children[m].shapes[0])}}if(g.afterClearScreen!=undefined){g.afterClearScreen()}}};this.displayObjectFile=function(m,l){if(m.objectClass=="P"&&m.numberVertices<=81924){g.createBrain(m,l)}else{if(m.objectClass=="P"){g.createPolygonObject(m,l)}else{if(m.objectClass=="L"){g.createLineObject(m,l)}else{alert("Object file not supported")}}}if(g.afterDisplayObject!=undefined){g.afterDisplayObject(g.brainTransform)}};function c(n,l,m){if(m==null){m=g.data}if(m.fixRange==false||m.fixRange==null){m.rangeMin=n;m.rangeMax=l}}this.updateClearColor=function(l){g.viewInfo.clearBuffer.clearColor=l};this.updateClearColorFromName=function(l){if(l=="white"){g.updateClearColor([1,1,1,1])}else{if(l=="black"){g.updateClearColor([0,0,0,1])}else{if(l=="pink"){g.updateClearColor([1,0,1,1])}else{g.updateClearColor([0.5,0.5,0.5,1])}}}};this.blinnphongParams=function(q){var r=q.getParam("transAlpha");r.value=1;var v=q.getParam("lightWorldPos");v.value=g.eyeView;var l=q.getParam("ambient");var p=q.getParam("ambientIntensity");var o=q.getParam("lightIntensity");var t=q.getParam("specular");var s=q.getParam("emissive");var m=q.getParam("colorMult");var u=q.getParam("wires");u.value=false;l.value=[0.04,0.04,0.04,1];p.value=[1,1,1,1];o.value=[0.8,0.8,0.8,1];t.value=[0.5,0.5,0.5,1];s.value=[0,0,0,1];m.value=[1,1,1,1];var n=q.getParam("shininess");n.value=100;return q};this.resetView=function(){g.brainTransform.children[0].visible=true;g.brainTransform.children[1].visible=true;g.brainTransform.identity();g.brainTransform.children[0].identity();g.brainTransform.children[1].identity()};this.setupView=function(l){g.resetView();if(g.model_data&&g.model_data.num_hemispheres==2){var m=g.getViewParams();switch(m.view){case"superior":g.superiorView();break;case"medial":g.medialView();break;case"anterior":g.anteriorView();break;case"inferior":g.inferiorView();break;case"lateral":g.lateralView();break;case"posterior":g.posteriorView();break;default:g.superiorView();break}}if(m.left==true){g.leftHemisphereVisible(true)}else{g.leftHemisphereVisible(false)}if(m.right==true){g.rightHemisphereVisible(true)}else{g.rightHemisphereVisible(false)}g.thatRot=g.math.matrix4.mul(g.brainTransform.localMatrix,g.math.matrix4.identity())};this.leftHemisphereVisible=function(l){g.brainTransform.children[0].visible=l};this.rightHemisphereVisible=function(l){g.brainTransform.children[1].visible=l};this.medialView=function(l){if(g.model_data.num_hemispheres==2){g.brainTransform.children[0].translate([-100,0,0]);g.brainTransform.children[1].translate([100,0,0]);g.brainTransform.children[0].rotateZ(g.math.degToRad(-90));g.brainTransform.children[1].rotateZ(g.math.degToRad(90));g.brainTransform.rotateX(g.math.degToRad(-90))}};this.lateralView=function(l){if(g.model_data.num_hemispheres==2){g.brainTransform.children[0].translate([-100,0,0]);g.brainTransform.children[1].translate([100,0,0]);g.brainTransform.children[0].rotateZ(g.math.degToRad(-90));g.brainTransform.children[1].rotateZ(g.math.degToRad(90));g.brainTransform.rotateX(g.math.degToRad(90));g.brainTransform.rotateY(g.math.degToRad(180))}};this.superiorView=function(){};this.inferiorView=function(){g.brainTransform.rotateY(g.math.degToRad(180))};"";this.anteriorView=function(l){g.resetView();g.brainTransform.rotateX(g.math.degToRad(-90));g.brainTransform.rotateZ(g.math.degToRad(180))};this.posteriorView=function(l){g.resetView();g.brainTransform.rotateX(g.math.degToRad(-90))};this.separateHemispheres=function(l){if(g.model_data.num_hemispheres==2){this.brainTransform.children[0].translate([-1,0,0]);this.brainTransform.children[1].translate([1,0,0])}};window.onresize=function(l){g.client.height=$(window).height()};this.setClientSize=function(){var m=parseInt(g.client.width);var l=parseInt(g.client.height);if(m!=g.o3dWidth||l!=g.o3dHeight){g.o3dWidth=m;g.o3dHeight=l;g.updateProjection();g.aball.setAreaSize(g.o3dWidth,g.o3dHeight)}};this.ZoomInOut=function(m){for(var l=0;l<g.eyeView.length;l+=1){g.eyeView[l]=g.eyeView[l]/m}g.viewInfo.drawContext.view=g.math.matrix4.lookAt(g.eyeView,[0,0,0],[0,1,0])};g.scrollMe=function(m){var l=(m.deltaY<0)?1/g.zoomFactor:g.zoomFactor;g.ZoomInOut(l);g.client.render()};function h(l){k();if(l){g.selectedInfo=l}}this.updateInfo=function(){if(!g.treeInfo){g.treeInfo=o3djs.picking.createPickManager(g.client.root)}g.treeInfo.update()};function k(){if(g.selectedInfo){g.highlightShape=null;g.selectedInfo=null}}this.click=function(r,o){var n=o3djs.picking.clientPositionToWorldRay(r.x,r.y,g.viewInfo.drawContext,g.client.width,g.client.height);k();g.treeInfo.update();var p=g.treeInfo.pick(n);if(p){h(p);var t=p.rayIntersectionInfo.primitiveIndex;var q=p.rayIntersectionInfo.position;var l=p.element.owner.name;var s=g.model_data.get_vertex(t,q,l);var m={ray_position:q,position_vector:s.position_vector,element:p.element,hemisphere:l,vertex:s.vertex};return o(r,m)}return false};this.getInfoForVertex=function(l){return g.model_data.getVertexInfo(l)};function j(m){var l;var n;if(m.pageX!=undefined&&m.pageY!=undefined){l=m.pageX;n=m.pageY}else{l=m.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;n=m.clientY+document.body.scrollTop+document.documentElement.scrollTop}l-=g.o3dElement.offsetLeft;n-=g.o3dElement.offsetTop;return{x:l,y:n}}this.startDragging=function(m){if(m.button==g.o3d.Event.BUTTON_RIGHT){var l=j(m);g.startPosition=o3djs.picking.clientPositionToWorldRay(l.x,l.y,g.viewInfo.drawContext,g.client.height,g.client.width).far;g.dragging=true}else{if(m.shiftKey&&m.ctrlKey&&g.model_data.num_hemispheres==2){g.drag_hemisphere=click(m,function(n,o){if(o.hemisphere=="left"){return 0}else{if(o.hemisphere=="right"){return 1}else{return false}}})}g.lastRot=g.thatRot;g.aball.click([m.x,m.y]);g.dragging=true}};this.drag=function(s){if(g.dragging&&s.button==g.o3d.Event.BUTTON_LEFT){var o=g.aball.drag([s.x,s.y]);var n=g.quaternions.quaternionToRotation(o);g.thatRot=g.math.matrix4.mul(g.lastRot,n);if(g.drag_hemisphere===0||g.drag_hemisphere===1){var l=g.brainTransform.children[g.drag_hemisphere].localMatrix;g.math.matrix4.setUpper3x3(l,g.thatRot);g.brainTransform.children[g.drag_hemisphere].localMatrix=l}else{var l=g.brainTransform.localMatrix;g.math.matrix4.setUpper3x3(l,g.thatRot);g.brainTransform.localMatrix=l}}else{if(g.dragging&&s.button==g.o3d.Event.BUTTON_RIGHT){var r=j(s);var q=o3djs.picking.clientPositionToWorldRay(r.x,r.y,g.viewInfo.drawContext,g.client.height,g.client.width).far;t=[0,0,0];var p=g.eyeView[0];var t=[(q[0]-g.startPosition[0])/5000*g.eyeView[2],(q[1]-g.startPosition[1])/5000*g.eyeView[2],0];g.startPosition=q;g.brainTransform.translate(t)}else{if(g.dragging){g.stopDragging(s)}}}};this.stopDragging=function(l){g.drag_hemisphere=false;g.dragging=false};this.updateCamera=function(){var l=[0,1,0];g.viewInfo.drawContext.view=g.math.matrix4.lookAt(g.camera.eye,g.camera.target,l);g.lightPosParam.value=g.camera.eye};this.updateProjection=function(){g.viewInfo.drawContext.projection=g.math.matrix4.perspective(g.math.degToRad(45),g.o3dWidth/g.o3dHeight,g.camera.nearPlane,g.camera.farPlane)};this.keyPressedAction=function(l,n){var m=false;switch(l){case"&":g.ZoomInOut(g.zoomFactor);m="zoom_in";break;case"(":g.ZoomInOut(1/g.zoomFactor);m="zoom_out";break;case" ":g.separateHemispheres();m="separate";break}return m};this.keyPressedCallback=function(m){var l=false;switch(m.which){case 38:g.ZoomInOut(g.zoomFactor);l="ZoomIn";break;case 40:g.ZoomInOut(1/g.zoomFactor);l="ZoomOut";break;case 32:g.separateHemispheres();l="Seperate";break}if(l){return false}else{return true}};this.set_fill_mode_wireframe=function(){if(g.model_data.num_hemispheres==2){var l=g.brainTransform.children[0].shapes[0].elements[0].material;g.state=g.pack.createObject("State");l.state=g.state;var m=l.getParam("wires");m.value=true;g.state.getStateParam("FillMode").value=g.o3d.State.WIREFRAME;l=g.brainTransform.children[1].shapes[0].elements[0].material;l.state=g.state;m=l.getParam("wires");m.value=true}else{var l=g.brainTransform.shapes[0].elements[0].material;g.state=g.pack.createObject("State");l.state=g.state;g.state.getStateParam("FillMode").value=g.o3d.State.WIREFRAME;var m=l.getParam("wires");m.value=true}g.client.render()};this.set_fill_mode_solid=function(){if(g.model_data.num_hemispheres==2){var l=g.brainTransform.children[0].shapes[0].elements[0].material;g.state1=g.pack.createObject("State");l.state=g.state1;var m=l.getParam("wires");m.value=false;g.state.getStateParam("FillMode").value=g.o3d.State.SOLID;l=g.brainTransform.children[1].shapes[0].elements[0].material;l.state=g.state;var m=l.getParam("wires");m.value=false}else{var l=g.brainTransform.shapes[0].elements[0].material;g.state=g.pack.createObject("State");l.state=g.state;g.state.getStateParam("FillMode").value=g.o3d.State.SOLID;var m=l.getParam("wires");m.value=false}};function b(l,m,n){jQuery.ajax({type:"GET",url:l,dataType:"text",success:function(o){n(o)},error:function(o,q,p){alert("Failure: "+q)},data:{},async:m,timeout:100000})}function a(o,n){var l=new FileReader();var m=o.files;l.file=m[0];l.onloadend=function(p){n(p.target.result)};l.readAsText(m[0])}this.loadObjFromUrl=function(l){b(l,false,function(n){var o=l.split("/");var m=o[o.length-1];g.displayObjectFile(new MNIObject(n),m)})};this.loadObjFromFile=function(l){a(l,function(m){var o=l.value.split("\\");var n=o[o.length-1];g.displayObjectFile(new MNIObject(m),n)})};this.loadSpectrumFromUrl=function(l){b(l,true,function(n){var m=new Spectrum(n);g.spectrum=m;if(g.afterLoadSpectrum!=null){g.afterLoadSpectrum(m)}if(g.data){g.updateColors(g.data,g.data.rangeMin,g.data.rangeMax,g.spectrum,g.flip,g.clamped)}})};this.loadSpectrumFromFile=function(l){a(l,function(n){var m=new Spectrum(n);g.spectrum=m;if(g.afterLoadSpectrum!=null){g.afterLoadSpectrum(m)}if(g.data){g.updateColors(g.data,g.data.rangeMin,g.data.rangeMax,g.spectrum,g.flip,g.clamped)}})};function f(l){}this.loadDataFromFile=function(r){var l=r.files[0].name;var p=function(t){var s=new Data(t);s.fileName=l;if(s.values.length<g.model_data.positionArray.length/4){alert("Number of numbers in datafile lower than number of vertices Vertices"+g.model_data.positionArray.length/3+" data values:"+s.values.length);return -1}else{g.data=s}c(g.data.min,g.data.max);if(g.afterLoadData!=null){g.afterLoadData(g.data.rangeMin,g.data.rangeMax,g.data)}g.updateColors(g.data,g.data.rangeMin,g.data.rangeMax,g.spectrum,g.flip,g.clamped);return null};if(l.match(/.*.mnc|.*.nii/)){var q=new XMLHttpRequest();if(l.match(/.*.mnc/)){q.open("POST","/minc/volume_object_evaluate",false)}else{q.open("POST","/nii/volume_object_evaluate",false)}var n=document.getElementById("datafile-form");var o=new FormData(n);q.send(o);var m=q.response;p(m)}else{a(r,p)}};this.loadSeriesDataFromFile=function(q){console.log(q.files.length);var p=q.files.length;g.seriesData=new Array(p);g.seriesData.numberFiles=p;var n=q.files;for(var m=0;m<p;m++){var l=new FileReader();l.file=n[m];var o=l.onloadend=(function(s,r){return function(t){console.log(t.target.result.length);console.log(r);g.seriesData[r]=new Data(t.target.result);g.seriesData[r].fileName=s.name}})(l.file,m);l.readAsText(n[m])}g.setupSeries()};this.setupSeries=function(){$('<div id="series">Series: </div>').appendTo("#surface_choice");var l=$("#series");$('<span id="series-value">0</span>').appendTo(l);$('<div id="series-slider" width="100px" + height="10"></div>').slider({value:0,min:0,max:g.seriesData.numberFiles-1,step:0.1,slide:function(m,n){if(n.value-Math.floor(n.value)<0.01){g.data=g.seriesData[n.value]}else{if(g.seriesData[0].fileName.match("pval.*")){g.data=new Data(interpolateDataArray(g.seriesData[Math.floor(n.value)],g.seriesData[Math.floor(n.value)+1],(n.value-Math.floor(n.value)),true))}else{g.data=new Data(interpolateDataArray(g.seriesData[Math.floor(n.value)],g.seriesData[Math.floor(n.value)+1],(n.value-Math.floor(n.value))))}}if(g.seriesData[0].fileName.match("mt.*")){$("#age_series").html("Age: "+(n.value*3+5).toFixed(1))}else{if(g.seriesData[0].fileName.match("pval.*")){$("#age_series").html("Age: "+(n.value*1+10))}}$(l).children("#series-value").html(n.value);if(g.data.values.length<g.model_data.positionArray.length/4){console.log("Number of numbers in datafile lower than number of vertices Vertices"+g.model_data.positionArray.length/3+" data values:"+g.data.values.length);return -1}c(g.data.min,g.data.max);if(g.afterLoadData!=null){g.afterLoadData(g.data.rangeMin,g.data.rangeMax,g.data)}g.updateColors(g.data,g.data.rangeMin,g.data.rangeMax,g.spectrum,g.flip,g.clamped);return null}}).appendTo(l)};this.loadBlendDataFromFile=function(q){var p=q.files.length;g.blendData=new Array(p);g.blendData.numberFiles=p;var n=q.files;for(var m=0;m<p;m++){var l=new FileReader();l.file=n[m];var o=l.onloadend=(function(s,r){return function(u){g.blendData[r]=new Data(u.target.result);g.blendData.alpha=1/p;g.blendData[r].fileName=s.name;for(var t=0;t<2;t++){if(g.blendData[t]==undefined){console.log("not done yet");return}}c(g.blendData[0].values.min(),g.blendData[0].values.max(),g.blendData[0]);c(g.blendData[1].values.min(),g.blendData[1].values.max(),g.blendData[1]);if(g.afterLoadData!=null){g.afterLoadData(null,null,g.blendData,true)}g.blend($(".blend_slider").slider("value"))}})(l.file,m);l.readAsText(n[m])}g.setupBlendColors()};this.setupBlendColors=function(){console.log("Blend colors has ran "+g.blendData.numberFiles);$("#blend").remove();$('<div id="blend">Blend ratios: </div>').appendTo("#surface_choice");var l=$("#blend");$('<span id="blend_value'+i+'">0</span>').appendTo(l);$('<div class="blend_slider" id="blend_slider'+i+'" width="100px" + height="10"></div>').slider({value:0,min:0.1,max:0.99,value:0.5,step:0.01,slide:function(m,n){g.blend($(this).slider("value"))}}).appendTo(l)};this.blend=function(m){g.blendData[0].alpha=m;g.blendData[1].alpha=1-m;for(var l=2;l<g.blendData.length;l++){g.blendData[l].alpha=0}g.updateColors(g.blendData,null,null,g.spectrum,g.flip,g.clamped,true)};this.loadDataFromUrl=function(l){b(l,true,function(n,m){g.data=new Data(n);c(g.data.min,g.data.max);if(g.afterLoadData!=undefined){g.afterLoadData(g.data.rangeMin,g.data.rangeMax,g.data)}g.updateColors(g.data,g.data.rangeMin,g.data.rangeMax,g.spectrum)})};this.loadCombinedShaderFromUrl=function(l){var m;b(l,false,function(n){m=n});return m};this.updateColors=function(G,x,B,E,o,w,z){g.clamped=w;if(z){var F=e.blendColorMap(E,G,0,1)}else{var F=G.createColorArray(x,B,E,o,w,g.model_data.colorArray)}if(g.model_data.num_hemispheres==1){var t=g.pack.createObject("VertexBuffer");var y=t.createField("FloatField",4);t.set(F);var n=g.brainTransform.shapes[0];var r=n.elements[0].streamBank;r.setVertexStream(g.o3d.Stream.COLOR,0,y,0)}else{var m=F.slice(0,F.length/2);var v=F.slice(F.length/2,F.length);var s=g.pack.createObject("VertexBuffer");var C=s.createField("FloatField",4);s.set(m);var q=g.brainTransform.children[0].shapes[0];var u=q.elements[0].streamBank;u.setVertexStream(g.o3d.Stream.COLOR,0,C,0);var A=g.pack.createObject("VertexBuffer");var p=A.createField("FloatField",4);A.set(v);var D=g.brainTransform.children[1].shapes[0];var l=D.elements[0].streamBank;l.setVertexStream(g.o3d.Stream.COLOR,0,p,0);g.client.render()}if(g.afterUpdateColors!=null){g.afterUpdateColors(G,x,B,E)}return 1};this.rangeChange=function(m,l,n){g.rangeMin=m;g.rangeMax=l;g.updateColors(g.data,g.rangeMin,g.rangeMax,g.spectrum,g.flip,n);if(g.afterRangeChange!=null){g.afterRangeChange(m,l)}};this.changeShapeTransparency=function(o,p){var m=null;if(g.brainTransform.shapes!=undefined){for(var n=0;n<g.brainTransform.shapes.length;n++){if(g.brainTransform.shapes[n].name==o){m=g.brainTransform.shapes[n]}}}for(var l=0;l<g.brainTransform.children.length;l++){for(var n=0;n<g.brainTransform.children[l].shapes.length;n++){if(g.brainTransform.children[l].shapes[n].name==o){m=g.brainTransform.children[l].shapes[n]}}}if(m){m.elements[0].material.getParam("transAlpha").value=p}};this.getImageUrl=function(){var o=document.createElement("canvas");var l=document.getElementById("spectrum_canvas");o.width=g.o3dElement.width;o.height=g.o3dElement.height;var p=o.getContext("2d");var m=new Image();function n(){var q=new Image();q.onload=function(){p.drawImage(q,0,0);window.open(o.toDataURL(),"screenshot")};q.src=l.toDataURL()}m.onload=function(){p.drawImage(m,0,0);n()};m.src=g.o3dElement.toDataURL()};g.init()}var brainbrowser;function SurfView(){var a=this;brainbrowser=new BrainBrowser();this.brainbrowser=brainbrowser;brainbrowser.getViewParams=function(){return{view:jQuery("[name=hem_view]:checked").val(),left:jQuery("#left_hem_visible").attr("checked"),right:jQuery("#right_hem_visible").attr("checked")}};brainbrowser.afterLoadSpectrum=function(b){var c=b.createSpectrumCanvasWithScale(0,100,null);c.id="spectrum_canvas";var d=document.getElementById("color_bar");if(!d){jQuery('<div id="color_bar"></div>').html(c).appendTo("#data-range")}else{jQuery(d).html(c)}brainbrowser.spectrumObj=b};brainbrowser.afterDisplayObject=function(d){$("#shapes").html("");if(d.shapes!=undefined){for(var e=0;e<d.shapes.length;e++){var c=d.shapes[e];$('<div id="shape_'+e+'" data-shape-name="'+c.name+'" class="shape"><h4>Shape '+(e+1)+"</h4>Name: "+c.name+'<br />Opacity: <div class="opacity-slider slider"  data-shape-name='+c.name+"></div></div>").appendTo("#shapes")}}if(d.children.length>0){for(var b=0;b<d.children.length;b++){for(var e=0;e<d.children[b].shapes.length;e++){var c=d.children[b].shapes[e];$('<div id="shape_'+e+'" data-shape-name="'+c.name+'" class="shape"><h4>Shape '+(e+1)+"</h4>Name: "+c.name+'<br />Opacity: <div class="opacity-slider slider"  data-shape-name='+c.name+"></div></div>").appendTo("#shapes")}}}brainbrowser.afterClearScreen=function(){$("#shapes").html("")};$(".opacity-slider").slider({value:100,min:0,max:100,slide:function(f,h){var g=$(f.target).attr("data-shape-name");var j=$(f.target).slider("value")/100;brainbrowser.changeShapeTransparency(g,j)}})};jQuery("#resetview").click(brainbrowser.setupView);jQuery(".view_button").change(brainbrowser.setupView);jQuery("[name=hem_view]").change(brainbrowser.setupView);this.updateCoordinates=function(b,d,c){jQuery("#x-coord").val(b[0]);jQuery("#y-coord").val(b[1]);jQuery("#z-coord").val(b[2]);jQuery("#v-coord").val(d);jQuery("#value-coord").val(c)};brainbrowser.afterInit=function(c){c.clamped=true;c.flip=false;c.clearScreen();c.loadObjFromUrl("/models/surf_reg_model_both.obj");jQuery("body").keydown(c.keyPressedCallback);o3djs.event.addEventListener(c.o3dElement,"mousedown",function(d){if(d.shiftKey){c.click(d,function(g,f){if(brainbrowser.data){a.updateCoordinates(f.position_vector,f.vertex,brainbrowser.data.values[f.vertex])}})}else{c.startDragging(d)}});o3djs.event.addEventListener(c.o3dElement,"mousemove",function(d){c.drag(d)});o3djs.event.addEventListener(c.o3dElement,"mouseup",function(d){if(!d.shiftKey||d.button==c.o3d.Event.BUTTON_RIGHT){c.stopDragging(d)}});$(c.o3dElement).bind("contextmenu",function(d){return false});jQuery("#range-slider").slider({range:true,min:-50,max:50,value:[-10,10],slide:function(f,g){var e=parseFloat(g.values[0]);var d=parseFloat(g.values[1]);c.rangeChange(e,d,$("#clamp_range").attr("checked"))},step:0.1});c.afterRangeChange=function(f,d){jQuery("#data-range-min").val(f);jQuery("#data-range-max").val(d);var e=c.spectrumObj.createSpectrumCanvasWithScale(f,d,null);e.id="spectrum_canvas";jQuery("#color_bar").html(jQuery(e))};function b(h){var d=$("#data-range");$(d).html("");var g='<div id="data_range_multiple"><ul>';if(!h.length){var h=[h]}for(var f=0;f<h.length;f++){g+='<li><a href="#data_file'+f+'">'+h[f].fileName+"</a></li>"}g+="</ul>";for(var e=0;e<h.length;e++){g+='<div id="data_file'+e+'" class="box full_box"><h4>Thresholding</h4>Min: <input class="range-box" id="data-range-min" type="text" name="range_min" size="5" ><br /><div id="range-slider+'+e+'" data-blend-index="'+e+'" class="slider"></div>Max: <input class="range-box" id="data-range-max" type="text" name="range_max" size="5" ><input type="checkbox" class="button" id="fix_range"><label for="fix_range">Fix Range</label><input type="checkbox" class="button" id="clamp_range" checked="true"><label for="clamp_range">Clamp range</label><input type="checkbox" class="button" id="flip_range"><label for="flip_range">Flip Colors</label></div>'}g+="</div>";$(d).html(g);$(d).tabs();$("#data_range").find(".slider").each(function(j,k){$(k).slider({range:true,min:h[j].values.min(),max:h[j].values.max(),values:[h[j].rangeMin,h[j].rangeMax],slide:function(m,n){var l=$(m.target).attr("data-blend-index");c.blendData[l].rangeMin=n.values[0];c.blendData[l].rangeMax=n.values[1];c.blend($(".blend_slider").slider("value"))}})})}c.afterLoadData=function(f,e,g,d){if(d){b(g)}else{b(g);jQuery("#range-slider").slider("values",0,parseFloat(f));jQuery("#range-slider").slider("values",1,parseFloat(e));c.afterRangeChange(f,e)}};jQuery("#meshmode").change(function(d){if(jQuery(d.target).attr("checked")==true){c.set_fill_mode_wireframe()}else{c.set_fill_mode_solid()}});jQuery("#clearshapes").click(function(d){brainbrowser.clearScreen()});jQuery("#openImage").click(function(d){brainbrowser.getImageUrl()});jQuery("#fix_range").click(function(d,e){c.fixRange=jQuery("#fix_range").attr("checked")});jQuery("#clamp_range").change(function(g){var f=parseFloat(jQuery("#data-range-min").val());var d=parseFloat(jQuery("#data-range-max").val());if($(g.target).attr("checked")==true){c.rangeChange(f,d,true)}else{c.rangeChange(f,d,false)}});jQuery("#flip_range").change(function(d){c.flip=$(d.target).attr("checked");c.updateColors(c.data,c.data.min,c.data.max,brainbrowser.spectrum,c.flip,c.clamped)});jQuery("#autorotate").change(function(d){c.autoRotate=$(d.target).attr("checked")});jQuery(".range-box").keypress(function(d){if(d.keyCode=="13"){c.rangeChange(parseFloat(jQuery("#data-range-min").val()),parseFloat(jQuery("#data-range-max").val()))}});jQuery("#clearColor").change(function(f){var d=$(f.target).val();c.updateClearColorFromName(d)});jQuery("#data-range-min").change(function(d){jQuery("#range-slider").slider("values",0,parseFloat(jQuery(this).val()))});jQuery("#data-range-max").change(function(d){jQuery("#range-slider").slider("values",1,parseFloat(jQuery(this).val()))});$("#examples").click(function(f){var d=$(f.target).attr("data-example-name");switch(d){case"basic":c.clearScreen();c.loadObjFromUrl("/models/surf_reg_model_both.obj");break;case"punkdti":c.clearScreen();c.loadObjFromUrl("/models/dti.obj");c.loadObjFromUrl("/models/left_color.obj");c.loadObjFromUrl("/models/right_color.obj");break;case"realct":c.clearScreen();c.loadObjFromUrl("/models/realct.obj");c.loadDataFromUrl("/models/realct.txt");break}return false})}};