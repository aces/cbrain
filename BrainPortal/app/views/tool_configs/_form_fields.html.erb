
<div class="groupentry">

  <%= hidden_field_tag "tool_config[tool_id]",     @tool_config.tool_id %>
  <%= hidden_field_tag "tool_config[bourreau_id]", @tool_config.bourreau_id %>

  <% if @tool_config.tool_id && @tool_config.bourreau_id %>
  <span title="Project access for this configuration.">
    <p><%= f.label :group_id, "Available to members of project:" %>
    <%= group_select "tool_config[group_id]", @tool_config.group_id %>
    </p>
  </span>

  <span title="Brief description for this configuration.">
    <p><%= f.label :description, "Description:" %><br/>
    <%= f.text_area :description, :cols => 40, :rows => 10 %><br/>
    <small>The first line must be a short summary, and the rest are for any special notes for the users.</small>
    </p>
  </span>

  <span title="Suggested number of CPUs to use in parallel, per task">
    <p><%= f.label :ncpus, "Suggested number of CPUs to use in parallel, per task:" %>
    <%= f.select :ncpus, [ 1, 2, 3, 4, 5, 6, 7, 8, 12, 16, 20, 24, 32, 64, 128, 256, 512 ] %>
    </p>
  </span>
  <% end %>

  <% context = @tool_config.tool_id ? "tool" : "Execution Server" %>
  <span title="Environment variables needed for this <%= context %>">
    <p><label>Environment variables needed for this <%= context %>:</label><br/>
    <% @tool_config.env_array.each do |env_name_value| %>
      <% env_name  = env_name_value[0] %>
      <% env_value = env_name_value[1] %>
      <%= render :partial => 'env_key_value_pair', :locals => { :env_name => env_name, :env_value => env_value } %>
    <% end %>
    <% 1.upto(5) do %>
      <%= render :partial => 'env_key_value_pair', :locals => { :env_name => "", :env_value => "" } %>
    <% end %>
    <small>In the generated script, the values shown here will be placed in double quotes automatically.</small>
    </p>
  </span>

  <span title="BASH initialization prologue">
    <p><%= f.label :script_prologue, "BASH initialization prologue:" %><br/>
    <%= f.text_area :script_prologue, :cols => 80, :rows => 10 %><br/>
    <small>This is a multi line partial BASH script. It can use the environment variables defined above,
           and do anything else you feel is needed to activate this configuration.
           <br/> Note that this script should usually be silent, as outputing text (like in <em>echo</em> statements)
           could interfere with the proper processing of the task's output.</small>
    </p>
  </span>

  <p>
  Option: Merge configuration from another existing entry:
  <%= tool_config_select :merge_from_tc_id, {}, { :include_blank => 'Merge from...' } %>
  <%= submit_tag 'Merge Configuration' %><br/>
  <small>
  <% if @tool_config.tool_id && @tool_config.bourreau_id %>
    The description, environment variables and prologue script will be appended to whatever
    values are currently in the form. The project and suggested number of CPUs will be changed.
  <% else %>
    The environment variables and prologue script will be appended to whatever
    values are currently in the form.
  <% end %>
  </small>
  </p>

</div>

