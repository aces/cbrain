
<%-
#
# CBRAIN Project
#
# Copyright (C) 2008-2012
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.  
#
-%>

<%
# uniq_id needed because there can be several load_info DIVs in the page
uniq_id = rand(100000).to_s 
%>
<% 
   num_online = @bourreaux.count { |b| b.online? }
   select_attributes = {
     "class"            => 'request_on_change',
     "data-loading-message" => "&nbsp;",
     "data-target"      => "#load_info_#{uniq_id}",
     "data-url"         => '/bourreaux/load_info'
   }
   select_attributes[:include_blank] = "Random Execution Server"         if num_online > 1
   select_attributes[:include_blank] = "No online server for this tool!" if num_online == 0
   selected_by_default = current_user.meta["pref_bourreau_id"]
   @bourreau   = selected_by_default.blank? ? nil : Bourreau.find_by_id(selected_by_default)
   @bourreau ||= @bourreaux.detect { |b| b.online? } if num_online == 1
%>

<div>

  On execution server:
  <%= bourreau_select("bourreau_id",
                      { :selector  => @bourreau,
                        :bourreaux => @bourreaux
                      },
                      select_attributes
                     )
  %>

  <% if num_online > 0 %>
    <%= hijacker_submit_button("Launch Tool", :url         => url_for(:controller  => :tasks, :action  => :new),
                                              :method      => :post,
                                              :class       => "button",
                                              :ajax_submit => false)
    %>
  <% end %>

  <br/>
  <br/>

  <div id="load_info_<%= uniq_id %>">
  <% if @bourreaux.size > 0 && @bourreau %>
    <%= render :partial => 'bourreaux/load_info', :locals => { :bourreau => @bourreau } %>
  <% end %>
  </div>

</div>

