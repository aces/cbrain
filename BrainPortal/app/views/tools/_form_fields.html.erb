
<%= f.error_messages %>

<p>
 <%= f.label :name, "Tool Name:" %>
 <%= f.text_field :name %>
</p>

<p>
  <span title="PortalTask subclass which implements this tool.">
     <%= f.label :cbrain_task_class, "CbrainTask Class:" %>
     <%= f.text_field :cbrain_task_class %>
  </span>
</p>

<p>
 <%= f.label :user_id, "Belongs to:" %>
 <%= user_select "tool[user_id]", @tool, :id => 'tool_user_id' %>
</p>

<p>
 <%= f.label :group_id, "Available to members of project:" %>
 <%= group_select "tool[group_id]", @tool, :id => 'tool_group_id' %>
</p>

<p>
  <%= f.label :category, "Category:" %>
  <%= f.select :category, Tool::Categories %>  
</p>

<p>
  <%= f.label :description, "Description:" %><br>
  <%= f.text_area :description, :cols => 80, :rows => 10 %><br>
  <small>The first line must should be a short summary, and the rest are for any special notes for the users.</small>
</p>

<p>
  <%= f.label :select_menu_text, "Text for select box on the userfiles page:" %>
  <%= f.text_field :select_menu_text %>
</p>

<% if @tool && !@tool.new_record? %>
<p>
  Common configuration for all servers: <%= link_to "Edit", new_tool_config_path( :tool_id => @tool.id ) %><br/>
</p>
<p>
  Versions installed on the following execution servers:<br/>
  <table class="simple" width="100%">
    <% for bourreau in @bourreaux %>
      <tr>
          <th colspan="6" class="centered">
            <%= link_to_bourreau_if_accessible(bourreau) %>
          </th>
      </tr>
      <% tcs = ToolConfig.where( :bourreau_id => bourreau.id, :tool_id => @tool.id ) %>
      <% tcs << 'Dummy entry for "add new" row' %>
      <% rows = tcs.size %>
      <% tcs.each_with_index do |tc,i| %>
        <tr class="<%= cycle("list-odd", "list-even") %>">
          <% if i == rows - 1 %>
            <td colspan="6">
              <center>
              <% if rows <= 1 %>
                <%= html_colorize("(No specific versions configured).") %>
              <% else %>
                <%= pluralize(rows-1," version") + " configured." %>
              <% end %>
              <%= link_to "Add new", new_tool_config_path( :tool_id => @tool.id, :bourreau_id => bourreau.id ) %>
              </center>
            </td>
          <% else %>
            <td><%= overlay_description(tc.description) %></td>
            <td><%= link_to_group_if_accessible(tc.group) %></td>
            <td><%= pluralize((tc.ncpus || 1), "cpu") %></td>
            <td><%= link_to "Edit", edit_tool_config_path(tc) %></td>
            <td><%= link_to "Show", tool_config_path(tc) %></td>
            <td><%= link_to 'Delete', tc, :confirm => "Are you sure you want to delete version configuration '#{tc.short_description}'?", :method => :delete %></td>
          <% end %>
        </tr>
      <% end %>
    <% end %>
  </table>
</p>
<% end %>

