
<tr>
    <th> 
       <%= select_all_checkbox "task_checkbox" %>
    </th>


    <th id="task_type_header" onMouseOver="jQuery('#task_filters_list').show()" onMouseOut="jQuery('#task_filters_list').hide()">
      <%= ajax_sort_link "Task Name", 'cbrain_tasks.type' %>
      <% unless @task_types.blank? %>
        <br>
        <ul class="filter_list" id="task_filters_list" style="display:none;">
           <% @task_types.sort.each do |task_type| %>
              <li>
                <%= 
                  ajax_link h(crop_text_to(20, task_type.sub(/^CbrainTask::/, ""))), {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:type  => task_type}}}, 
                                                                                    :datatype  => 'script'
                %> 
              </li> 
           <% end %>
         </ul>
      <% end %>
    </th>



    <th onMouseOver="jQuery('#description_filters_list').show()" onMouseOut="jQuery('#description_filters_list').hide()">
       <%= ajax_link "Description", { :controller  => :tasks, :action  => :index, :tasks  => {:sort  => {:order  => 'cbrain_tasks.description', :dir  => set_dir('cbrain_tasks.description', @filter_params["sort"])}} }, 
                                  :datatype  => 'script'
       %>
        <%= set_order_icon('cbrain_tasks.description', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
    </th>



    <th onMouseOver="jQuery('#owner_filters_list').show()" onMouseOut="jQuery('#owner_filters_list').hide()">
       <%= ajax_sort_link "Owner", 'users.login' %>
       <% unless @task_owners.blank? %>
         <br>
           <ul class="filter_list" id="owner_filters_list" style="display:none;">
              <% @task_owners.sort_by(&:login).each do |task_owner| %>
                 <li>
                   <%= ajax_link h(task_owner.login), {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:user_id  => task_owner.id}}}, :datatype  => 'script' %>
                 </li> 
              <% end %>
           </ul>
        <% end %>
    </th>



    <% unless current_project %>
      <th onMouseOver="jQuery('#project_filters_list').show()" onMouseOut="jQuery('#project_filters_list').hide()">
        <%= ajax_sort_link "Project", 'groups.name' %>
        <% unless @task_projects.blank? %>
          <br>
          <ul class="filter_list" id="project_filters_list" style="display:none;">
             <% @task_projects.sort_by(&:name).each do |task_project| %>
                <li>
                  <%= ajax_link h(task_project.name), {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:group_id  => task_project.id}}}, :datatype  => 'script' %>
                </li> 
             <% end %>
          </ul>
        <% end %>
      </th>
    <% end %>



    <th onMouseOver="jQuery('#bourreau_filters_list').show()" onMouseOut="jQuery('#bourreau_filters_list').hide()">
      <%= ajax_sort_link "Execution Server", 'remote_resources.name' %>
      <% unless @bourreaux.blank? %>
         <br>
           <ul class="filter_list" id="bourreau_filters_list" style="display:none;">
              <% @bourreaux.sort_by(&:name).each do |bourreau| %>
                 <li>
                    <%= 
                        ajax_link h(bourreau.name),  {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:bourreau_id  => bourreau.id}}}, 
                                                    :datatype  => 'script'
                    %>
                 </li> 
              <% end %>
           </ul>
      <% end %>
    </th>



    <th onMouseOver="jQuery('#status_filters_list').show()" onMouseOut="jQuery('#status_filters_list').hide()">
      <%= ajax_sort_link "Current Status", 'cbrain_tasks.status' %>
      <% unless @task_status.blank? %>
        <br>
          <ul class="filter_list" id="status_filters_list" style="display:none;">
             <% @task_status.sort.each do |task_status| %>
                <li>
                  <%= 
                      ajax_link h(task_status),  {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:status  => task_status}}}, 
                                                :datatype  => 'script'
                  %>
                </li> 
             <% end %>
          </ul>
      <% end %>
    </th>



    <th>Run Number</th>



    <th>
      <%= ajax_sort_link "Time Submitted", 'cbrain_tasks.created_at' %>
    </th>



    <th>
      <%= ajax_sort_link "Last Updated", 'cbrain_tasks.updated_at' %>
    </th>

</tr>



<% if @filter_params["sort"]["order"] == 'cbrain_tasks.launch_time DESC, cbrain_tasks.created_at' %>
  <%= render :partial => 'tasks/batch_view'  %>
<% else %>
  <%= render :partial => 'tasks/list_view' %>
<% end %>
        
<% if @tasks.blank? %>
  <tr class="list-odd"><td colspan="<%= 9 + (current_project ? 0 : 1) %>">There are no tasks in this list.</td></tr>
<% end %>

