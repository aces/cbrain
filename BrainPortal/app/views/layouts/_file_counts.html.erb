
<%
   # This partial requires these hashes:
   #    fileclasses_totcount[fileclass]        -> number of files of class 'fileclass'
   #    user_fileclass_count[user][fileclass]  -> number of files belonging to 'user' in class 'fileclass'
   #    user_totcount[user]                    -> number of files belonging to 'user'
%>

<% sorted_classes = fileclasses_totcount.keys.sort { |a,b| a <=> b } %>
<% sorted_users   = user_fileclass_count.keys.sort { |a,b| a.login <=> b.login } %>
 
<table>
  <tr>
    <th colspan="<%= 2 + sorted_classes.size %>">File Registration Statistics</th>
  </tr>
  <tr>
    <th>User</th>
    <% sorted_classes.each do |klass| %>
      <th><%= h(klass) %></th>
    <% end %>
    <th>Total</th>
  </tr>
  <% sorted_users.each do |user| %>
    <% login        = user.login %>
    <% klass_counts = user_fileclass_count[user] || {} %>
    <% usertot      = user_totcount[user] || 0 %>
    <% next if usertot == 0 %>
    <tr>
      <td><%= h(login) %></td>
      <% sorted_classes.each do |klass| %>
        <% count = klass_counts[klass] || "" %>
        <td><%= filter_reset_link h(count), :controller => :userfiles, :filters => {:user_id => user.id, :file_format => klass}, :clear_params => :clear_filter, :ajax => false %></td>
      <% end %>
      <td><%= filter_reset_link h(usertot), :controller => :userfiles, :filters => {:user_id => user.id}, :clear_params => :clear_filter, :ajax => false %></td>
    </tr>
  <% end %>
</table>

