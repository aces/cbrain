#!/usr/bin/env ruby
#
# This file was generated by RubyGems.
#
# The application 'mongrel' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require 'rubygems'

version = ">= 0"

if ARGV.first =~ /^_(.*)_$/ and Gem::Version.correct? $1 then
  version = $1
  ARGV.shift
end



#==============================================================
# CBRAIN Project
#
# Original author: Pierre Rioux
#
# $Id: cbrain_remote_ctl 510 2009-09-23 18:56:43Z prioux $
#

#
# CBRAIN patch that makes the server write the word 'STOPPED'
# to a status file when the server exits (whether it's properly
# or as a result of a failure to start).
#
# The path to the status file is provided by an environment
# variable, and usually this is setup by the cbrain_remote_ctl
# script.
#

server_status_file = ENV['CBRAIN_SERVER_STATUS_FILE']
if server_status_file && server_status_file =~ /^\//
  wrapper_pid = Process.pid
  Kernel.at_exit do
    Process.wait if Process.pid == wrapper_pid
    current_pid        = Process.pid
    current_parent_pid = Process.ppid
    if current_pid != wrapper_pid && current_parent_pid != wrapper_pid # this code is only for the forked subprocess
      begin
        File.open(server_status_file,"w") do |fh|
          fh.write "STOPPED\n"
        end
      rescue
        puts "Warning: can't write 'STOPPED' to status file '#{server_status_file}'.\n"
      end
    end
  end
end

# End of CBRAIN patch
#==============================================================

gem 'mongrel', version
load 'mongrel_rails'

